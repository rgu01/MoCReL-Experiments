<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.5//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_5.dtd'>
<nta>
	<declaration>const int GOALRANGE = 1000;
const int NOAGENTS = 4;
const int NOMILESTONES = 6;
const int NOTASKS = 3;
const int NODEVICES = 6;
const int NOEVENTS = 1;

typedef int[0,GOALRANGE] goalrange_t;
typedef int[-1,NOAGENTS-1] agentid_t;  // agent id range
typedef int[-1,NOMILESTONES-1] milestoneid_t; // milestone id range
typedef int[-2,NOTASKS-1] taskid_t; // task id range
typedef int[-1,NODEVICES-1] deviceid_t;
typedef int[-1,NOEVENTS-1] eventid_t;
typedef int[0,86400] time_t; // time is in seconds (24 hours is the maximum)
typedef int[0,10] size_t;

const time_t TOTALTIME = 7200; // total time of the game: 1 hour

typedef int[0,3] taskstatus_t;  // task status
const taskstatus_t UNSTARTED = 0; // not started yet
const taskstatus_t STARTED = 1; // started
const taskstatus_t FINISHED  = 2; // finished
const taskstatus_t WAITING  = 3; // waiting for being started

typedef int[0,2] eventstatus_t;
const eventstatus_t SLEEP = 0;
const eventstatus_t ACTIVATED = 1;
const eventstatus_t OVERDUE = 2;

typedef struct {
    agentid_t p_agent;
    taskid_t p_task;
} precondition_t;

typedef struct {
    agentid_t c_agent;
    milestoneid_t c_position;
} collaboration_t;

typedef struct {
    deviceid_t d_id;
    milestoneid_t d_position;
} device_t;

typedef struct {
    taskid_t t_id;
    device_t t_deviceUse; // the device that is currently used by the task
    device_t t_deviceReq[NODEVICES]; // the requirement of devices of this task
} task_t;

typedef struct {   
    milestoneid_t a_position;
    task_t a_task;
    taskstatus_t a_status[NOTASKS];
    eventstatus_t a_monitors[NOEVENTS];
} agent_t;

const milestoneid_t ONTHEWAY = -1;
const milestoneid_t UNKOWNPOS = -1;
const deviceid_t NULLDEVICE = -1;
const device_t UNKOWNDEVICE = {NULLDEVICE, UNKOWNPOS};
const taskid_t ID_IDLE = -1;
const task_t TASK_IDLE = {ID_IDLE, UNKOWNDEVICE, {UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE}};
const taskid_t ID_MOVING = -2;
const task_t TASK_MOVING = {ID_MOVING, UNKOWNDEVICE, {UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE}};

broadcast chan exe[NOAGENTS], done[NOAGENTS];
broadcast chan go[NOAGENTS];
broadcast chan react[NOAGENTS][NOEVENTS];
clock timeConsumption; // the total time consumption

/**discrete variables in the templates*/
goalrange_t missionGoal = 1;
goalrange_t var = 0; // the variable that can be changed by tasks
agent_t agents[NOAGENTS]; // the agents
bool timeup = false;

/**judge if the mission goal is archieved*/
bool isGameWon()
{
    return var &gt;= missionGoal;
}

/**judge if a monitor of the agent is alert*/
bool isEventOccur(agentid_t agentID, eventid_t eventID) {
    return agents[agentID].a_monitors[eventID] == ACTIVATED;
}

bool isEventOverdue(agentid_t agentID, eventid_t eventID) {
    return agents[agentID].a_monitors[eventID] == OVERDUE;
}

bool isMonitorAlert(agentid_t agentID) {
    /*size_t i;

    for(i = 0; i &lt; NOEVENTS; i++) {
        if(isEventOccur(agentID, i)) {
            return true;
        }
    }*/

    return false;
}

bool isMonitorStop(agentid_t agentID) {
    size_t i;

    for(i = 0; i &lt; NOEVENTS; i++) {
        if(isEventOverdue(agentID, i)) {
            return true;
        }
    }

    return false;
}

/**functions for tasks*/
bool isExecutable(agentid_t agentID, task_t task) {
    bool ready = false;
    size_t i;

    if(timeup || isGameWon() || isMonitorStop(agentID)) {
        return false;
    }
    for(i = 0; i &lt; NODEVICES; i++) {
        if(task.t_deviceReq[i] != UNKOWNDEVICE) {
            // if the agent is at the position that contains a device belonging to the devide requirement of the task
            ready = ready || (agents[agentID].a_position == task.t_deviceReq[i].d_position);
        }
    }
    
    return ready;
}

device_t getDevice(agentid_t agentID, task_t task) {
    size_t i = 0;
    device_t deviceWouldUse = UNKOWNDEVICE;

    for(i = 0; i &lt; NODEVICES; i++) {
        if((task.t_deviceReq[i].d_position != UNKOWNPOS) &amp;&amp; 
           (task.t_deviceReq[i].d_position == agents[agentID].a_position)) {
            deviceWouldUse = task.t_deviceReq[i];
        }
    }

    return deviceWouldUse;
}

bool isBusy(agentid_t agentID, task_t task) {
    size_t i = 0;
    device_t deviceWouldUse = getDevice(agentID, task);

    if(deviceWouldUse.d_id == NULLDEVICE) { // if I do not require any device, then the target task is always not busy
        return false;
    }

    for(i = 0; i &lt; NOAGENTS; i++) {
        if(i!=agentID) {
            // if the agent is at the same position of another agent and their in-use device is the same
            if((agents[agentID].a_position == agents[i].a_position) &amp;&amp; 
               (deviceWouldUse == agents[i].a_task.t_deviceUse)) {
                if(agents[i].a_status[task.t_id] == STARTED) {
                    return true;
                }
            }
        }
    }

    return false;
}

void start(agentid_t agentID, task_t task) {
    size_t i = 0;

    agents[agentID].a_task = task;
    agents[agentID].a_status[task.t_id] = STARTED;
    agents[agentID].a_task.t_deviceUse = getDevice(agentID, task);
}

void finish(agentid_t agentID, task_t task, const bool last) {
    size_t i = 0;

    agents[agentID].a_task = TASK_IDLE;
    agents[agentID].a_status[task.t_id] = FINISHED;
    if(last) {
        for(i = 0; i &lt; NOTASKS; i++) {
            agents[agentID].a_status[i] = UNSTARTED;
        }
    }
}

void wait(agentid_t agentID, task_t task) {
    agents[agentID].a_task = task;
    agents[agentID].a_status[task.t_id] = WAITING;
}
</declaration>
	<template>
		<name x="5" y="5">Movement</name>
		<parameter>const agentid_t agentID, const milestoneid_t p1, const milestoneid_t p2, const time_t cost, const task_t taskOnP1, const task_t taskOnP2</parameter>
		<declaration>clock xm;

bool isReady(int position) {
    if(timeup || isGameWon() || isMonitorStop(agentID)) {
        return false;
    }
    if(agents[agentID].a_position == position &amp;&amp; agents[agentID].a_task == TASK_IDLE) {
        if(agents[agentID].a_status[taskOnP1.t_id] == FINISHED ||
           agents[agentID].a_status[taskOnP2.t_id] == UNSTARTED) { 
            return true;
        }
    }

    return false;
}

void move() {
    xm = 0;
    agents[agentID].a_task = TASK_MOVING;
    agents[agentID].a_position = ONTHEWAY;
}

void reach(int target) {
    xm = 0;
    agents[agentID].a_task = TASK_IDLE;
    agents[agentID].a_position = target;
}</declaration>
		<location id="id0" x="136" y="-34">
			<name x="144" y="-68">P2</name>
		</location>
		<location id="id1" x="-102" y="-34">
			<name x="-119" y="-68">F1T2</name>
			<label kind="invariant" x="-136" y="-17">xm&lt;=cost</label>
		</location>
		<location id="id2" x="-340" y="-34">
			<name x="-365" y="-68">P1</name>
			<label kind="exponentialrate" x="-350" y="0">100</label>
		</location>
		<init ref="id2"/>
		<transition controllable="false">
			<source ref="id0"/>
			<target ref="id2"/>
			<label kind="synchronisation" x="-17" y="34">go[agentID]?</label>
			<nail x="136" y="59"/>
			<nail x="-340" y="59"/>
		</transition>
		<transition controllable="false">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="guard" x="-25" y="-93">xm&gt;=cost</label>
			<label kind="synchronisation" x="-25" y="-76">go[agentID]!</label>
			<label kind="assignment" x="-25" y="-59">reach(p2)</label>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id1"/>
			<label kind="guard" x="-314" y="-85">isReady(p1)</label>
			<label kind="assignment" x="-314" y="-59">move()</label>
		</transition>
	</template>
	<template>
		<name>TaskNoCondition</name>
		<parameter>const agentid_t agentID, const time_t BCET, const time_t WCET, const task_t task, const bool last</parameter>
		<declaration>clock xe;</declaration>
		<location id="id3" x="0" y="34">
			<name x="-17" y="51">Waiting</name>
			<label kind="exponentialrate" x="-10" y="68">100</label>
		</location>
		<location id="id4" x="-374" y="34">
			<name x="-391" y="51">Idle</name>
			<label kind="exponentialrate" x="-384" y="68">100</label>
		</location>
		<location id="id5" x="0" y="-204">
			<name x="17" y="-212">Executing</name>
			<label kind="invariant" x="9" y="-187">xe&lt;=WCET</label>
		</location>
		<init ref="id4"/>
		<transition>
			<source ref="id4"/>
			<target ref="id5"/>
			<label kind="guard" x="-357" y="-314">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
!isMonitorAlert(agentID)</label>
			<label kind="assignment" x="-357" y="-229">xe=0,start(agentID,task)</label>
			<nail x="-374" y="-204"/>
		</transition>
		<transition controllable="false">
			<source ref="id5"/>
			<target ref="id4"/>
			<label kind="guard" x="-297" y="-110">xe&gt;=BCET</label>
			<label kind="assignment" x="-297" y="-85">xe=0,finish(agentID,task,last)</label>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id5"/>
			<label kind="guard" x="8" y="-136">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED</label>
			<label kind="assignment" x="8" y="-51">xe=0,start(agentID,task)</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id3"/>
			<label kind="guard" x="-348" y="42">isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
!isMonitorAlert(agentID)</label>
			<label kind="assignment" x="-348" y="127">xe=0,wait(agentID,task)</label>
		</transition>
	</template>
	<template>
		<name>TaskWithCondition</name>
		<parameter>const agentid_t agentID, const time_t BCET, const time_t WCET, const task_t task, const precondition_t precondition, const bool last</parameter>
		<declaration>clock xe;</declaration>
		<location id="id6" x="0" y="34">
			<name x="-17" y="51">Waiting</name>
			<label kind="exponentialrate" x="-10" y="68">100</label>
		</location>
		<location id="id7" x="-374" y="34">
			<name x="-391" y="51">Idle</name>
			<label kind="exponentialrate" x="-384" y="68">100</label>
		</location>
		<location id="id8" x="0" y="-204">
			<name x="17" y="-212">Executing</name>
			<label kind="invariant" x="9" y="-187">xe&lt;=WCET</label>
		</location>
		<init ref="id7"/>
		<transition>
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="guard" x="-357" y="-331">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[precondition.p_agent].a_status[precondition.p_task] != FINISHED &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
!isMonitorAlert(agentID)</label>
			<label kind="assignment" x="-357" y="-229">xe=0,start(agentID,task)</label>
			<nail x="-374" y="-204"/>
		</transition>
		<transition controllable="false">
			<source ref="id8"/>
			<target ref="id7"/>
			<label kind="guard" x="-297" y="-110">xe&gt;=BCET</label>
			<label kind="assignment" x="-297" y="-85">xe=0,finish(agentID,task,last)</label>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id8"/>
			<label kind="guard" x="8" y="-136">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[precondition.p_agent].a_status[precondition.p_task] != FINISHED &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED</label>
			<label kind="assignment" x="8" y="-34">xe=0,start(agentID,task)</label>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="guard" x="-348" y="42">isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[precondition.p_agent].a_status[precondition.p_task] != FINISHED &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
!isMonitorAlert(agentID)</label>
			<label kind="assignment" x="-348" y="144">xe=0,wait(agentID,task)</label>
		</transition>
	</template>
	<template>
		<name>TaskWithConditions</name>
		<parameter>const agentid_t agentID, const time_t BCET, const time_t WCET, const task_t task, const precondition_t preconditions[2], const goalrange_t speed, const bool last</parameter>
		<declaration>clock xe;</declaration>
		<location id="id9" x="0" y="34">
			<name x="-17" y="51">Waiting</name>
			<label kind="exponentialrate" x="-10" y="68">100</label>
		</location>
		<location id="id10" x="-374" y="34">
			<name x="-391" y="51">Idle</name>
			<label kind="exponentialrate" x="-384" y="68">100</label>
		</location>
		<location id="id11" x="0" y="-204">
			<name x="17" y="-212">Executing</name>
			<label kind="invariant" x="9" y="-187">xe&lt;=WCET</label>
		</location>
		<init ref="id10"/>
		<transition>
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="guard" x="-357" y="-357">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
(agents[preconditions[0].p_agent].a_status[preconditions[0].p_task] == FINISHED ||
agents[preconditions[1].p_agent].a_status[preconditions[1].p_task] == FINISHED)&amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
!isMonitorAlert(agentID)</label>
			<label kind="assignment" x="-357" y="-229">xe=0,start(agentID,task)</label>
			<nail x="-374" y="-204"/>
		</transition>
		<transition controllable="false">
			<source ref="id11"/>
			<target ref="id10"/>
			<label kind="guard" x="-297" y="-110">xe&gt;=BCET</label>
			<label kind="assignment" x="-297" y="-85">xe=0,finish(agentID,task,last),
var+=speed</label>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id11"/>
			<label kind="guard" x="8" y="-153">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
(agents[preconditions[0].p_agent].a_status[preconditions[0].p_task] == FINISHED ||
agents[preconditions[1].p_agent].a_status[preconditions[1].p_task] == FINISHED)&amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED</label>
			<label kind="assignment" x="8" y="-25">xe=0,start(agentID,task)</label>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id9"/>
			<label kind="guard" x="-357" y="42">isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
(agents[preconditions[0].p_agent].a_status[preconditions[0].p_task] == FINISHED ||
agents[preconditions[1].p_agent].a_status[preconditions[1].p_task] == FINISHED)&amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
!isMonitorAlert(agentID)</label>
			<label kind="assignment" x="-357" y="170">xe=0,wait(agentID,task)</label>
		</transition>
	</template>
	<template>
		<name>TaskEvent</name>
		<parameter>const agentid_t agentID, const eventid_t event, const time_t BCET, const time_t WCET, const task_t task</parameter>
		<declaration>clock xe;</declaration>
		<location id="id12" x="0" y="34">
			<name x="-17" y="51">Waiting</name>
			<label kind="exponentialrate" x="-10" y="68">100</label>
		</location>
		<location id="id13" x="-374" y="34">
			<name x="-391" y="51">Idle</name>
			<label kind="exponentialrate" x="-384" y="68">100</label>
		</location>
		<location id="id14" x="0" y="-204">
			<name x="17" y="-212">Executing</name>
			<label kind="invariant" x="9" y="-187">xe&lt;=WCET</label>
		</location>
		<init ref="id13"/>
		<transition>
			<source ref="id13"/>
			<target ref="id14"/>
			<label kind="guard" x="-357" y="-297">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
isEventOccur(agentID, event)</label>
			<label kind="assignment" x="-357" y="-229">xe=0,start(agentID,task)</label>
			<nail x="-374" y="-204"/>
		</transition>
		<transition controllable="false">
			<source ref="id14"/>
			<target ref="id13"/>
			<label kind="guard" x="-297" y="-136">xe&gt;=BCET</label>
			<label kind="synchronisation" x="-297" y="-110">react[agentID][event]!</label>
			<label kind="assignment" x="-297" y="-85">xe=0,
agents[agentID].a_task = TASK_IDLE</label>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id14"/>
			<label kind="guard" x="8" y="-127">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
isEventOccur(agentID, event)</label>
			<label kind="assignment" x="8" y="-59">xe=0,start(agentID,task)</label>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id12"/>
			<label kind="guard" x="-348" y="42">isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
isEventOccur(agentID, event)</label>
			<label kind="assignment" x="-348" y="110">xe=0,wait(agentID,task)</label>
		</transition>
	</template>
	<template>
		<name>Monitor</name>
		<parameter>agentid_t agentID, const eventid_t event, time_t warning, time_t shutdown</parameter>
		<declaration>clock xo;</declaration>
		<location id="id15" x="238" y="-34">
			<name x="212" y="-68">Stop</name>
		</location>
		<location id="id16" x="34" y="-34">
			<name x="-17" y="-59">Alert</name>
			<label kind="invariant" x="-76" y="-25">xo&lt;=shutdown</label>
		</location>
		<location id="id17" x="-238" y="-34">
			<name x="-229" y="-59">Run</name>
			<label kind="invariant" x="-229" y="-25">xo&lt;=warning</label>
		</location>
		<init ref="id17"/>
		<transition controllable="false">
			<source ref="id16"/>
			<target ref="id15"/>
			<label kind="guard" x="76" y="-25">xo&gt;=shutdown</label>
			<label kind="assignment" x="51" y="-8">agents[agentID].a_monitors[event]=OVERDUE</label>
		</transition>
		<transition controllable="false">
			<source ref="id16"/>
			<target ref="id17"/>
			<label kind="synchronisation" x="-221" y="8">react[agentID][event]?</label>
			<label kind="assignment" x="-221" y="25">xo=0,
agents[agentID].a_monitors[event]=SLEEP</label>
			<nail x="34" y="68"/>
			<nail x="-238" y="68"/>
		</transition>
		<transition controllable="false">
			<source ref="id17"/>
			<target ref="id16"/>
			<label kind="guard" x="-221" y="-119">xo&gt;=warning</label>
			<label kind="assignment" x="-221" y="-93">agents[agentID].a_monitors[event]=ACTIVATED</label>
			<nail x="-238" y="-68"/>
			<nail x="34" y="-68"/>
		</transition>
	</template>
	<template>
		<name>Referee</name>
		<parameter>const agent_t initialData[NOAGENTS], const goalrange_t goal</parameter>
		<declaration>clock xr;

void initialize() {
    size_t i = 0, j = 0;

    missionGoal = goal;
    for(i = 0; i &lt; NOAGENTS; i++) {
        agents[i].a_position = initialData[i].a_position;
        agents[i].a_task = initialData[i].a_task;
        for(j = 0; j &lt; NOTASKS; j++) {
            agents[i].a_status[j] = initialData[i].a_status[j];
        }
    }
}</declaration>
		<location id="id18" x="-170" y="-136" color="#ff00ff">
			<name x="-180" y="-170">Lose</name>
		</location>
		<location id="id19" x="-170" y="0" color="#00ffff">
			<name x="-161" y="-34">Win</name>
		</location>
		<location id="id20" x="-340" y="-68" color="#00ff00">
			<name x="-365" y="-119">Ongoing</name>
			<label kind="invariant" x="-467" y="-102">xr&lt;=TOTALTIME</label>
			<label kind="exponentialrate" x="-348" y="-51">100</label>
		</location>
		<location id="id21" x="-544" y="-68">
			<name x="-578" y="-119">Begin</name>
			<committed/>
		</location>
		<init ref="id21"/>
		<transition controllable="false">
			<source ref="id20"/>
			<target ref="id18"/>
			<label kind="guard" x="-323" y="-153">xr&gt;=TOTALTIME</label>
			<label kind="assignment" x="-323" y="-136">timeup = true</label>
		</transition>
		<transition>
			<source ref="id20"/>
			<target ref="id19"/>
			<label kind="guard" x="-289" y="-51">isGameWon()</label>
		</transition>
		<transition controllable="false">
			<source ref="id21"/>
			<target ref="id20"/>
			<label kind="assignment" x="-476" y="-51">initialize()</label>
		</transition>
	</template>
	<template>
		<name>Collaboration_I</name>
		<parameter>const agentid_t agentID, const time_t BCET, const time_t WCET, const task_t task, const precondition_t precondition, const collaboration_t collaborations[3], const bool last</parameter>
		<declaration>clock xe;
agentid_t helper = -1;</declaration>
		<location id="id22" x="136" y="51">
			<name x="119" y="68">Waiting</name>
			<label kind="exponentialrate" x="126" y="85">100</label>
		</location>
		<location id="id23" x="-374" y="51">
			<name x="-391" y="68">Idle</name>
			<label kind="exponentialrate" x="-384" y="102">100</label>
		</location>
		<location id="id24" x="136" y="-204">
			<name x="153" y="-212">Executing</name>
			<label kind="invariant" x="145" y="-187">xe&lt;=WCET</label>
		</location>
		<init ref="id23"/>
		<transition>
			<source ref="id23"/>
			<target ref="id24"/>
			<label kind="select" x="-357" y="-425">h:int[0,2]</label>
			<label kind="guard" x="-357" y="-399">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[precondition.p_agent].a_status[precondition.p_task] == FINISHED &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
(agents[collaborations[h].c_agent].a_position == collaborations[h].c_position &amp;&amp;
agents[collaborations[h].c_agent].a_position == agents[agentID].a_position) &amp;&amp;
!isMonitorAlert(agentID)</label>
			<label kind="synchronisation" x="-357" y="-255">exe[collaborations[h].c_agent]!</label>
			<label kind="assignment" x="-357" y="-229">xe=0,helper=collaborations[h].c_agent,start(agentID,task)</label>
			<nail x="-374" y="-204"/>
		</transition>
		<transition controllable="false">
			<source ref="id24"/>
			<target ref="id23"/>
			<label kind="guard" x="-297" y="-127">xe&gt;=BCET</label>
			<label kind="synchronisation" x="-297" y="-102">done[helper]!</label>
			<label kind="assignment" x="-297" y="-76">xe=0,finish(agentID,task,last)</label>
		</transition>
		<transition>
			<source ref="id22"/>
			<target ref="id24"/>
			<label kind="guard" x="144" y="-161">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[precondition.p_agent].a_status[precondition.p_task] == FINISHED &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
(agents[collaborations[helper].c_agent].a_position == collaborations[helper].c_position &amp;&amp;
agents[collaborations[helper].c_agent].a_position == agents[agentID].a_position)</label>
			<label kind="synchronisation" x="144" y="-17">exe[helper]!</label>
			<label kind="assignment" x="144" y="9">xe=0,start(agentID,task)</label>
		</transition>
		<transition>
			<source ref="id23"/>
			<target ref="id22"/>
			<label kind="select" x="-331" y="59">h:int[0,2]</label>
			<label kind="guard" x="-331" y="85">isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[precondition.p_agent].a_status[precondition.p_task] == FINISHED &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
(agents[collaborations[h].c_agent].a_position == collaborations[h].c_position &amp;&amp;
agents[collaborations[h].c_agent].a_position == agents[agentID].a_position) &amp;&amp;
!isMonitorAlert(agentID)</label>
			<label kind="assignment" x="-331" y="229">xe=0,helper=collaborations[h].c_agent,wait(agentID,task)</label>
		</transition>
	</template>
	<template>
		<name>Collaboration_H</name>
		<parameter>const agentid_t agentID, const task_t task, const precondition_t precondition, const collaboration_t collaborations[1], const bool last</parameter>
		<declaration>clock xe;
agentid_t initiator = -1;</declaration>
		<location id="id25" x="204" y="34">
			<name x="187" y="51">Waiting</name>
			<label kind="exponentialrate" x="194" y="68">100</label>
		</location>
		<location id="id26" x="-374" y="34">
			<name x="-391" y="51">Idle</name>
			<label kind="exponentialrate" x="-384" y="68">100</label>
		</location>
		<location id="id27" x="204" y="-204">
			<name x="221" y="-212">Executing</name>
		</location>
		<init ref="id26"/>
		<transition>
			<source ref="id26"/>
			<target ref="id27"/>
			<label kind="select" x="-357" y="-425">h:int[0,0]</label>
			<label kind="guard" x="-357" y="-399">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
agents[precondition.p_agent].a_status[precondition.p_task] != FINISHED &amp;&amp;
(agents[collaborations[h].c_agent].a_position == collaborations[h].c_position &amp;&amp;
agents[collaborations[h].c_agent].a_position == agents[agentID].a_position) &amp;&amp;
!isMonitorAlert(agentID)</label>
			<label kind="synchronisation" x="-357" y="-255">exe[agentID]?</label>
			<label kind="assignment" x="-357" y="-229">xe=0,start(agentID,task)</label>
			<nail x="-374" y="-204"/>
		</transition>
		<transition controllable="false">
			<source ref="id27"/>
			<target ref="id26"/>
			<label kind="synchronisation" x="-297" y="-102">done[agentID]?</label>
			<label kind="assignment" x="-297" y="-85">xe=0,finish(agentID,task,last)</label>
		</transition>
		<transition>
			<source ref="id25"/>
			<target ref="id27"/>
			<label kind="guard" x="212" y="-170">!isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
agents[precondition.p_agent].a_status[precondition.p_task] != FINISHED &amp;&amp;
(agents[collaborations[initiator].c_agent].a_position == collaborations[initiator].c_position &amp;&amp;
agents[collaborations[initiator].c_agent].a_position == agents[agentID].a_position)</label>
			<label kind="synchronisation" x="212" y="-42">exe[agentID]?</label>
			<label kind="assignment" x="212" y="-17">xe=0,start(agentID,task)</label>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id25"/>
			<label kind="select" x="-348" y="42">h:int[0,0]</label>
			<label kind="guard" x="-348" y="68">isBusy(agentID,task) &amp;&amp;
isExecutable(agentID,task) &amp;&amp;
agents[agentID].a_status[task.t_id] != FINISHED &amp;&amp;
agents[precondition.p_agent].a_status[precondition.p_task] != FINISHED &amp;&amp;
(agents[collaborations[h].c_agent].a_position == collaborations[h].c_position &amp;&amp;
agents[collaborations[h].c_agent].a_position == agents[agentID].a_position) &amp;&amp;
!isMonitorAlert(agentID)</label>
			<label kind="assignment" x="-348" y="221">xe=0,initiator=h,wait(agentID,task)</label>
		</transition>
	</template>
	<system>/**ID of agents*/
const agentid_t ID_WHEELLOADER0 = 0;
const agentid_t ID_TRUCK0 = 1;
const agentid_t ID_TRUCK1 = 2;
const agentid_t ID_TRUCK2 = 3;

/**ID of devices*/
const deviceid_t ID_DV_PC0 = 0;
const deviceid_t ID_DV_PC1 = 1;
const deviceid_t ID_DV_PC2 = 2;
const deviceid_t ID_DV_SC0 = 3;
const deviceid_t ID_DV_SC1 = 4;

/**ID of milestones*/
const milestoneid_t ID_STONE0 = 0;
const milestoneid_t ID_PRIMARYCRUSHER0 = 1;
const milestoneid_t ID_PRIMARYCRUSHER1 = 2;
const milestoneid_t ID_PRIMARYCRUSHER2 = 3;
const milestoneid_t ID_SECONDARYCRUSHER0 = 4;
const milestoneid_t ID_SECONDARYCRUSHER1 = 5;

/**ID of tasks*/
const taskid_t ID_DIG_WHEELLOADER = 0;
const taskid_t ID_UNLOAD_TO_TRUCKS_WHEELLOADER = 1;
const taskid_t ID_LOAD_FROM_WHEELLOADERS_TRUCK = 0; // loading from wl or loading from primary crusher
const taskid_t ID_LOAD_FROM_PRIMARY_TRUCK = 0; // truck only needs to choose one of them to execute, so the tasks' ID are the same
const taskid_t ID_UNLOAD_TO_SECONDARY_TRUCK = 1;
const taskid_t ID_TASK_CHARGE = 2; // charge task for wl and tk
/**ID of events*/
const eventid_t ID_EVENT_BATTERY_LOW = 0;
/**devices*/
const device_t DV_STONE0_NULL = {NULLDEVICE, ID_STONE0};
const device_t DV_PC0 = {ID_DV_PC0, ID_PRIMARYCRUSHER0};
const device_t DV_PC1 = {ID_DV_PC1, ID_PRIMARYCRUSHER1};
const device_t DV_PC2 = {ID_DV_PC2, ID_PRIMARYCRUSHER2};
const device_t DV_SC0 = {ID_DV_SC0, ID_SECONDARYCRUSHER0};
const device_t DV_SC1 = {ID_DV_SC1, ID_SECONDARYCRUSHER1};

/**tasks and their milestones*/
const task_t TASK_DIG = {ID_DIG_WHEELLOADER, UNKOWNDEVICE, {DV_STONE0_NULL, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE}};
const task_t TASK_UNLOAD_TO_TRUCKS = {ID_UNLOAD_TO_TRUCKS_WHEELLOADER, UNKOWNDEVICE, {DV_STONE0_NULL, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE}};
const task_t TASK_LOAD_FROM_WHEELLOADERS = {ID_LOAD_FROM_WHEELLOADERS_TRUCK, UNKOWNDEVICE, {DV_STONE0_NULL, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE}};
const task_t TASK_LOAD_FROM_PRIMARY = {ID_LOAD_FROM_PRIMARY_TRUCK, UNKOWNDEVICE, {DV_PC0, DV_PC1, DV_PC2, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE}};
const task_t TASK_UNLOAD_TO_SECONDARY = {ID_UNLOAD_TO_SECONDARY_TRUCK, UNKOWNDEVICE, {DV_SC0, DV_SC1, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE, UNKOWNDEVICE}};

/**preconditions of tasks*/
const precondition_t PRE_UNLOAD_TO_TRUCK_WL0 = {ID_WHEELLOADER0, ID_DIG_WHEELLOADER};
const precondition_t PRE_LOAD_FROM_WHEELLOADER_TRUCK0 = {ID_TRUCK0, ID_LOAD_FROM_PRIMARY_TRUCK};
const precondition_t PRE_LOAD_FROM_PRIMARY_TRUCK0 = {ID_TRUCK0, ID_LOAD_FROM_WHEELLOADERS_TRUCK};
const precondition_t PRE_UNLOAD_TO_SECONDARY_TRUCK0[2] = {{ID_TRUCK0, ID_LOAD_FROM_WHEELLOADERS_TRUCK}, {ID_TRUCK0, ID_LOAD_FROM_PRIMARY_TRUCK}};
const precondition_t PRE_LOAD_FROM_WHEELLOADER_TRUCK1 = {ID_TRUCK1, ID_LOAD_FROM_PRIMARY_TRUCK};
const precondition_t PRE_LOAD_FROM_PRIMARY_TRUCK1 = {ID_TRUCK1, ID_LOAD_FROM_WHEELLOADERS_TRUCK};
const precondition_t PRE_UNLOAD_TO_SECONDARY_TRUCK1[2] = {{ID_TRUCK1, ID_LOAD_FROM_WHEELLOADERS_TRUCK}, {ID_TRUCK1, ID_LOAD_FROM_PRIMARY_TRUCK}};
const precondition_t PRE_LOAD_FROM_WHEELLOADER_TRUCK2 = {ID_TRUCK2, ID_LOAD_FROM_PRIMARY_TRUCK};
const precondition_t PRE_LOAD_FROM_PRIMARY_TRUCK2 = {ID_TRUCK2, ID_LOAD_FROM_WHEELLOADERS_TRUCK};
const precondition_t PRE_UNLOAD_TO_SECONDARY_TRUCK2[2] = {{ID_TRUCK2, ID_LOAD_FROM_WHEELLOADERS_TRUCK}, {ID_TRUCK2, ID_LOAD_FROM_PRIMARY_TRUCK}};

/**collaboration between agents*/
const collaboration_t COL_UNLOAD_TO_TRUCKS_WL0[3] = {{ID_TRUCK0, ID_STONE0}, {ID_TRUCK1, ID_STONE0}, {ID_TRUCK2, ID_STONE0}};
const collaboration_t COL_LOAD_FROM_WHEELLOADERS[1] = {{ID_WHEELLOADER0, ID_STONE0}};

/**parameters of the mission*/
const goalrange_t GOAL = 200;
const goalrange_t CAPABILITY = 10;

/**initial information of agents*/
const agent_t INIT_WHEELLOADER0 = {ID_STONE0, TASK_IDLE, {UNSTARTED, UNSTARTED, UNSTARTED}, {SLEEP}};
const agent_t INIT_TRUCK0 = {ID_STONE0, TASK_IDLE, {UNSTARTED, UNSTARTED, UNSTARTED}, {SLEEP}};
const agent_t INIT_TRUCK1 = {ID_SECONDARYCRUSHER1, TASK_IDLE, {UNSTARTED, UNSTARTED, UNSTARTED}, {SLEEP}};
const agent_t INIT_TRUCK2 = {ID_SECONDARYCRUSHER0, TASK_IDLE, {UNSTARTED, UNSTARTED, UNSTARTED}, {SLEEP}};
const agent_t INIT_AGENTS[NOAGENTS] = {INIT_WHEELLOADER0,INIT_TRUCK0,INIT_TRUCK1,INIT_TRUCK2};

/** Agents */
Rong = Referee(INIT_AGENTS, GOAL);
/** Movement */
//wheel loder 0
//truck 0
m_stone0Secondary0_TK0 = Movement(ID_TRUCK0, ID_STONE0, ID_SECONDARYCRUSHER0, 136, TASK_LOAD_FROM_WHEELLOADERS, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Stone0_TK0 = Movement(ID_TRUCK0, ID_SECONDARYCRUSHER0, ID_STONE0, 136, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_WHEELLOADERS);
m_stone0Secondary1_TK0 = Movement(ID_TRUCK0, ID_STONE0, ID_SECONDARYCRUSHER1, 62, TASK_LOAD_FROM_WHEELLOADERS, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Stone0_TK0 = Movement(ID_TRUCK0, ID_SECONDARYCRUSHER1, ID_STONE0, 62, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_WHEELLOADERS);
m_primary0Secondary0_TK0 = Movement(ID_TRUCK0, ID_PRIMARYCRUSHER0, ID_SECONDARYCRUSHER0, 117, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Primary0_TK0 = Movement(ID_TRUCK0, ID_SECONDARYCRUSHER0, ID_PRIMARYCRUSHER0, 117, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary0Secondary1_TK0 = Movement(ID_TRUCK0, ID_PRIMARYCRUSHER0, ID_SECONDARYCRUSHER1, 144, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Primary0_TK0 = Movement(ID_TRUCK0, ID_SECONDARYCRUSHER1, ID_PRIMARYCRUSHER0, 144, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary1Secondary0_TK0 = Movement(ID_TRUCK0, ID_PRIMARYCRUSHER1, ID_SECONDARYCRUSHER0, 138, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Primary1_TK0 = Movement(ID_TRUCK0, ID_SECONDARYCRUSHER0, ID_PRIMARYCRUSHER1, 138, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary1Secondary1_TK0 = Movement(ID_TRUCK0, ID_PRIMARYCRUSHER1, ID_SECONDARYCRUSHER1, 135, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Primary1_TK0 = Movement(ID_TRUCK0, ID_SECONDARYCRUSHER1, ID_PRIMARYCRUSHER1, 135, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary2Secondary0_TK0 = Movement(ID_TRUCK0, ID_PRIMARYCRUSHER2, ID_SECONDARYCRUSHER0, 124, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Primary2_TK0 = Movement(ID_TRUCK0, ID_SECONDARYCRUSHER0, ID_PRIMARYCRUSHER2, 124, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary2Secondary1_TK0 = Movement(ID_TRUCK0, ID_PRIMARYCRUSHER2, ID_SECONDARYCRUSHER1, 109, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Primary2_TK0 = Movement(ID_TRUCK0, ID_SECONDARYCRUSHER1, ID_PRIMARYCRUSHER2, 109, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
//truck 1
m_stone0Secondary0_TK1 = Movement(ID_TRUCK1, ID_STONE0, ID_SECONDARYCRUSHER0, 70, TASK_LOAD_FROM_WHEELLOADERS, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Stone0_TK1 = Movement(ID_TRUCK1, ID_SECONDARYCRUSHER0, ID_STONE0, 70, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_WHEELLOADERS);
m_stone0Secondary1_TK1 = Movement(ID_TRUCK1, ID_STONE0, ID_SECONDARYCRUSHER1, 86, TASK_LOAD_FROM_WHEELLOADERS, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Stone0_TK1 = Movement(ID_TRUCK1, ID_SECONDARYCRUSHER1, ID_STONE0, 86, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_WHEELLOADERS);
m_primary0Secondary0_TK1 = Movement(ID_TRUCK1, ID_PRIMARYCRUSHER0, ID_SECONDARYCRUSHER0, 170, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Primary0_TK1 = Movement(ID_TRUCK1, ID_SECONDARYCRUSHER0, ID_PRIMARYCRUSHER0, 170, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary0Secondary1_TK1 = Movement(ID_TRUCK1, ID_PRIMARYCRUSHER0, ID_SECONDARYCRUSHER1, 140, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Primary0_TK1 = Movement(ID_TRUCK1, ID_SECONDARYCRUSHER1, ID_PRIMARYCRUSHER0, 140, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary1Secondary0_TK1 = Movement(ID_TRUCK1, ID_PRIMARYCRUSHER1, ID_SECONDARYCRUSHER0, 164, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Primary1_TK1 = Movement(ID_TRUCK1, ID_SECONDARYCRUSHER0, ID_PRIMARYCRUSHER1, 164, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary1Secondary1_TK1 = Movement(ID_TRUCK1, ID_PRIMARYCRUSHER1, ID_SECONDARYCRUSHER1, 109, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Primary1_TK1 = Movement(ID_TRUCK1, ID_SECONDARYCRUSHER1, ID_PRIMARYCRUSHER1, 109, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary2Secondary0_TK1 = Movement(ID_TRUCK1, ID_PRIMARYCRUSHER2, ID_SECONDARYCRUSHER0, 125, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Primary2_TK1 = Movement(ID_TRUCK1, ID_SECONDARYCRUSHER0, ID_PRIMARYCRUSHER2, 125, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary2Secondary1_TK1 = Movement(ID_TRUCK1, ID_PRIMARYCRUSHER2, ID_SECONDARYCRUSHER1, 75, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Primary2_TK1 = Movement(ID_TRUCK1, ID_SECONDARYCRUSHER1, ID_PRIMARYCRUSHER2, 75, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
//truck 2
m_stone0Secondary0_TK2 = Movement(ID_TRUCK2, ID_STONE0, ID_SECONDARYCRUSHER0, 161, TASK_LOAD_FROM_WHEELLOADERS, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Stone0_TK2 = Movement(ID_TRUCK2, ID_SECONDARYCRUSHER0, ID_STONE0, 161, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_WHEELLOADERS);
m_stone0Secondary1_TK2 = Movement(ID_TRUCK2, ID_STONE0, ID_SECONDARYCRUSHER1, 72, TASK_LOAD_FROM_WHEELLOADERS, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Stone0_TK2 = Movement(ID_TRUCK2, ID_SECONDARYCRUSHER1, ID_STONE0, 72, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_WHEELLOADERS);
m_primary0Secondary0_TK2 = Movement(ID_TRUCK2, ID_PRIMARYCRUSHER0, ID_SECONDARYCRUSHER0, 68, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Primary0_TK2 = Movement(ID_TRUCK2, ID_SECONDARYCRUSHER0, ID_PRIMARYCRUSHER0, 68, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary0Secondary1_TK2 = Movement(ID_TRUCK2, ID_PRIMARYCRUSHER0, ID_SECONDARYCRUSHER1, 71, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Primary0_TK2 = Movement(ID_TRUCK2, ID_SECONDARYCRUSHER1, ID_PRIMARYCRUSHER0, 71, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary1Secondary0_TK2 = Movement(ID_TRUCK2, ID_PRIMARYCRUSHER1, ID_SECONDARYCRUSHER0, 128, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Primary1_TK2 = Movement(ID_TRUCK2, ID_SECONDARYCRUSHER0, ID_PRIMARYCRUSHER1, 128, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary1Secondary1_TK2 = Movement(ID_TRUCK2, ID_PRIMARYCRUSHER1, ID_SECONDARYCRUSHER1, 128, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Primary1_TK2 = Movement(ID_TRUCK2, ID_SECONDARYCRUSHER1, ID_PRIMARYCRUSHER1, 128, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary2Secondary0_TK2 = Movement(ID_TRUCK2, ID_PRIMARYCRUSHER2, ID_SECONDARYCRUSHER0, 62, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary0Primary2_TK2 = Movement(ID_TRUCK2, ID_SECONDARYCRUSHER0, ID_PRIMARYCRUSHER2, 62, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
m_primary2Secondary1_TK2 = Movement(ID_TRUCK2, ID_PRIMARYCRUSHER2, ID_SECONDARYCRUSHER1, 143, TASK_LOAD_FROM_PRIMARY, TASK_UNLOAD_TO_SECONDARY);
m_secondary1Primary2_TK2 = Movement(ID_TRUCK2, ID_SECONDARYCRUSHER1, ID_PRIMARYCRUSHER2, 143, TASK_UNLOAD_TO_SECONDARY, TASK_LOAD_FROM_PRIMARY);
/** Tasks */
//wheel loder 0
t_digging_WL0 = TaskNoCondition(ID_WHEELLOADER0, 55, 56, TASK_DIG, false);
t_unloading_WL0 = Collaboration_I(ID_WHEELLOADER0, 59, 60, TASK_UNLOAD_TO_TRUCKS, PRE_UNLOAD_TO_TRUCK_WL0, COL_UNLOAD_TO_TRUCKS_WL0, true);
//truck 0
t_loadingFromWL_TK0 = Collaboration_H(ID_TRUCK0, TASK_LOAD_FROM_WHEELLOADERS, PRE_LOAD_FROM_WHEELLOADER_TRUCK0, COL_LOAD_FROM_WHEELLOADERS, false);
t_loadingFromPrimary_TK0 = TaskWithCondition(ID_TRUCK0, 31, 79, TASK_LOAD_FROM_PRIMARY, PRE_LOAD_FROM_PRIMARY_TRUCK0, false);
t_unloadingToSecond_TK0 = TaskWithConditions(ID_TRUCK0, 102, 104, TASK_UNLOAD_TO_SECONDARY, PRE_UNLOAD_TO_SECONDARY_TRUCK0, CAPABILITY, true);
//truck 1
t_loadingFromWL_TK1 = Collaboration_H(ID_TRUCK1, TASK_LOAD_FROM_WHEELLOADERS, PRE_LOAD_FROM_WHEELLOADER_TRUCK1, COL_LOAD_FROM_WHEELLOADERS, false);
t_loadingFromPrimary_TK1 = TaskWithCondition(ID_TRUCK1, 90, 114, TASK_LOAD_FROM_PRIMARY, PRE_LOAD_FROM_PRIMARY_TRUCK1, false);
t_unloadingToSecond_TK1 = TaskWithConditions(ID_TRUCK1, 80, 108, TASK_UNLOAD_TO_SECONDARY, PRE_UNLOAD_TO_SECONDARY_TRUCK1, CAPABILITY, true);
//truck 2
t_loadingFromWL_TK2 = Collaboration_H(ID_TRUCK2, TASK_LOAD_FROM_WHEELLOADERS, PRE_LOAD_FROM_WHEELLOADER_TRUCK2, COL_LOAD_FROM_WHEELLOADERS, false);
t_loadingFromPrimary_TK2 = TaskWithCondition(ID_TRUCK2, 112, 119, TASK_LOAD_FROM_PRIMARY, PRE_LOAD_FROM_PRIMARY_TRUCK2, false);
t_unloadingToSecond_TK2 = TaskWithConditions(ID_TRUCK2, 32, 102, TASK_UNLOAD_TO_SECONDARY, PRE_UNLOAD_TO_SECONDARY_TRUCK2, CAPABILITY, true);

system Rong,
/**map*/

m_stone0Secondary0_TK0,m_secondary0Stone0_TK0,m_stone0Secondary1_TK0,m_secondary1Stone0_TK0,

m_primary0Secondary0_TK0,m_secondary0Primary0_TK0,m_primary0Secondary1_TK0,m_secondary1Primary0_TK0,

m_primary1Secondary0_TK0,m_secondary0Primary1_TK0,m_primary1Secondary1_TK0,m_secondary1Primary1_TK0,

m_primary2Secondary0_TK0,m_secondary0Primary2_TK0,m_primary2Secondary1_TK0,m_secondary1Primary2_TK0,



m_stone0Secondary0_TK1,m_secondary0Stone0_TK1,m_stone0Secondary1_TK1,m_secondary1Stone0_TK1,

m_primary0Secondary0_TK1,m_secondary0Primary0_TK1,m_primary0Secondary1_TK1,m_secondary1Primary0_TK1,

m_primary1Secondary0_TK1,m_secondary0Primary1_TK1,m_primary1Secondary1_TK1,m_secondary1Primary1_TK1,

m_primary2Secondary0_TK1,m_secondary0Primary2_TK1,m_primary2Secondary1_TK1,m_secondary1Primary2_TK1,



m_stone0Secondary0_TK2,m_secondary0Stone0_TK2,m_stone0Secondary1_TK2,m_secondary1Stone0_TK2,

m_primary0Secondary0_TK2,m_secondary0Primary0_TK2,m_primary0Secondary1_TK2,m_secondary1Primary0_TK2,

m_primary1Secondary0_TK2,m_secondary0Primary1_TK2,m_primary1Secondary1_TK2,m_secondary1Primary1_TK2,

m_primary2Secondary0_TK2,m_secondary0Primary2_TK2,m_primary2Secondary1_TK2,m_secondary1Primary2_TK2,



/**tasks*/
t_digging_WL0,t_unloading_WL0,
t_loadingFromWL_TK0,t_loadingFromPrimary_TK0,t_unloadingToSecond_TK0,t_loadingFromWL_TK1,t_loadingFromPrimary_TK1,t_unloadingToSecond_TK1,t_loadingFromWL_TK2,t_loadingFromPrimary_TK2,t_unloadingToSecond_TK2;

</system>
	<queries>
		<option key="--learning-method" value="-1"/>
		<option key="--good-runs" value="100"/>
		<option key="--total-runs" value="100"/>
		<query>
			<formula>strategy policy = maxE(var * 50 - timeConsumption)[&lt;=TOTALTIME]{
Rong.location,

m_stone0Secondary0_TK0.location, m_secondary0Stone0_TK0.location, m_stone0Secondary1_TK0.location, m_secondary1Stone0_TK0.location, 

m_primary0Secondary0_TK0.location, m_secondary0Primary0_TK0.location, m_primary0Secondary1_TK0.location, m_secondary1Primary0_TK0.location, 

m_primary1Secondary0_TK0.location, m_secondary0Primary1_TK0.location, m_primary1Secondary1_TK0.location, m_secondary1Primary1_TK0.location, 

m_primary2Secondary0_TK0.location, m_secondary0Primary2_TK0.location, m_primary2Secondary1_TK0.location, m_secondary1Primary2_TK0.location, 



m_stone0Secondary0_TK1.location, m_secondary0Stone0_TK1.location, m_stone0Secondary1_TK1.location, m_secondary1Stone0_TK1.location, 

m_primary0Secondary0_TK1.location, m_secondary0Primary0_TK1.location, m_primary0Secondary1_TK1.location, m_secondary1Primary0_TK1.location, 

m_primary1Secondary0_TK1.location, m_secondary0Primary1_TK1.location, m_primary1Secondary1_TK1.location, m_secondary1Primary1_TK1.location, 

m_primary2Secondary0_TK1.location, m_secondary0Primary2_TK1.location, m_primary2Secondary1_TK1.location, m_secondary1Primary2_TK1.location, 



m_stone0Secondary0_TK2.location, m_secondary0Stone0_TK2.location, m_stone0Secondary1_TK2.location, m_secondary1Stone0_TK2.location, 

m_primary0Secondary0_TK2.location, m_secondary0Primary0_TK2.location, m_primary0Secondary1_TK2.location, m_secondary1Primary0_TK2.location, 

m_primary1Secondary0_TK2.location, m_secondary0Primary1_TK2.location, m_primary1Secondary1_TK2.location, m_secondary1Primary1_TK2.location, 

m_primary2Secondary0_TK2.location, m_secondary0Primary2_TK2.location, m_primary2Secondary1_TK2.location, m_secondary1Primary2_TK2.location, 



t_digging_WL0.location, t_unloading_WL0.location, 
t_loadingFromWL_TK0.location, t_loadingFromPrimary_TK0.location, t_unloadingToSecond_TK0.location, 
t_loadingFromWL_TK1.location, t_loadingFromPrimary_TK1.location, t_unloadingToSecond_TK1.location, 
t_loadingFromWL_TK2.location, t_loadingFromPrimary_TK2.location, t_unloadingToSecond_TK2.location, 
var,
agents[0].a_position, agents[0].a_monitors[0], agents[0].a_task.t_id, agents[0].a_task.t_deviceUse.d_id, agents[0].a_task.t_deviceUse.d_position, agents[0].a_status[ID_DIG_WHEELLOADER], agents[0].a_status[ID_UNLOAD_TO_TRUCKS_WHEELLOADER],
agents[1].a_position, agents[1].a_monitors[0], agents[1].a_task.t_id, agents[1].a_task.t_deviceUse.d_id, agents[1].a_task.t_deviceUse.d_position, agents[1].a_status[ID_DIG_WHEELLOADER], agents[1].a_status[ID_UNLOAD_TO_TRUCKS_WHEELLOADER],
agents[2].a_position, agents[2].a_monitors[0], agents[2].a_task.t_id, agents[2].a_task.t_deviceUse.d_id, agents[2].a_task.t_deviceUse.d_position, agents[2].a_status[ID_DIG_WHEELLOADER], agents[2].a_status[ID_UNLOAD_TO_TRUCKS_WHEELLOADER],
agents[3].a_position, agents[3].a_monitors[0], agents[3].a_task.t_id, agents[3].a_task.t_deviceUse.d_id, agents[3].a_task.t_deviceUse.d_position, agents[3].a_status[ID_DIG_WHEELLOADER], agents[3].a_status[ID_UNLOAD_TO_TRUCKS_WHEELLOADER]
}-&gt;{}:&lt;&gt; Rong.Win || Rong.Lose
</formula>
			<comment>for learning</comment>
			<result outcome="success" type="quality" timestamp="2021-10-04 18:30:57 +0200">
				<option key="--search-order" value="0"/>
				<option key="--statespace-consumption" value="1"/>
				<option key="--diagnostic" value="-1"/>
				<option key="--backwards-order" value="1"/>
				<option key="--priority-order" value="0"/>
				<option key="--generate-strategy" value="2"/>
				<option key="--extrapolation" value="0"/>
				<option key="--hashtable-size" value="27"/>
				<option key="--filter" value="0"/>
				<option key="--learning-method" value="-1"/>
				<option key="--good-runs" value="100"/>
				<option key="--total-runs" value="100"/>
				<option key="--runs-pr-state" value="100"/>
				<option key="--eval-runs" value="100"/>
				<option key="--max-iterations" value="30"/>
				<option key="--max-imitation" value="5"/>
				<option key="--reset-no-better" value="10"/>
				<option key="--max-reset-learning" value="3"/>
				<option key="--qlearning-alpha" value="2"/>
				<option key="--split-upper-t" value="1.75"/>
				<option key="--split-lower-t" value="0.15"/>
				<option key="--split-ks" value="0.25"/>
				<option key="--split-filter-rate" value="0.02"/>
				<option key="--split-filter-val" value="0.99"/>
				<option key="--discount" value="0.99"/>
				<option key="--random-search-limit" value="0.5"/>
				<option key="--deterministic-search-limit" value="0.5"/>
				<option key="--indifference-scale" value="0.005"/>
				<option key="--indifference-smoothing" value="10"/>
				<option key="--lower-delta" value="0.01"/>
				<option key="--upper-delta" value="0.01"/>
				<option key="--alpha" value="0.05"/>
				<option key="--beta" value="0.05"/>
				<option key="--epsilon" value="0.05"/>
				<option key="--u0" value="0.9"/>
				<option key="--u1" value="1.1"/>
				<option key="--histogram-bar-width" value="0.0"/>
				<option key="--histogram-bar-count" value="0"/>
				<option key="--resolution" value="4000"/>
				<option key="--discretization" value="0.01"/>
				<option key="--truncation-error" value="0.01"/>
				<option key="--truncation-time-error" value="0.01"/>
			</result>
		</query>
		<query>
			<formula>Pr[&lt;=TOTALTIME] (&lt;&gt; isGameWon()) under policy</formula>
			<comment/>
			<result outcome="success" type="interval" value="[0.950056,1] (95% CI)" timestamp="2021-10-04 18:37:54 +0200">
				<option key="--search-order" value="0"/>
				<option key="--statespace-consumption" value="1"/>
				<option key="--diagnostic" value="-1"/>
				<option key="--backwards-order" value="1"/>
				<option key="--priority-order" value="0"/>
				<option key="--generate-strategy" value="2"/>
				<option key="--extrapolation" value="0"/>
				<option key="--hashtable-size" value="27"/>
				<option key="--filter" value="0"/>
				<option key="--learning-method" value="-1"/>
				<option key="--good-runs" value="100"/>
				<option key="--total-runs" value="100"/>
				<option key="--runs-pr-state" value="100"/>
				<option key="--eval-runs" value="100"/>
				<option key="--max-iterations" value="30"/>
				<option key="--max-imitation" value="5"/>
				<option key="--reset-no-better" value="10"/>
				<option key="--max-reset-learning" value="3"/>
				<option key="--qlearning-alpha" value="2"/>
				<option key="--split-upper-t" value="1.75"/>
				<option key="--split-lower-t" value="0.15"/>
				<option key="--split-ks" value="0.25"/>
				<option key="--split-filter-rate" value="0.02"/>
				<option key="--split-filter-val" value="0.99"/>
				<option key="--discount" value="0.99"/>
				<option key="--random-search-limit" value="0.5"/>
				<option key="--deterministic-search-limit" value="0.5"/>
				<option key="--indifference-scale" value="0.005"/>
				<option key="--indifference-smoothing" value="10"/>
				<option key="--lower-delta" value="0.01"/>
				<option key="--upper-delta" value="0.01"/>
				<option key="--alpha" value="0.05"/>
				<option key="--beta" value="0.05"/>
				<option key="--epsilon" value="0.05"/>
				<option key="--u0" value="0.9"/>
				<option key="--u1" value="1.1"/>
				<option key="--histogram-bar-width" value="0.0"/>
				<option key="--histogram-bar-count" value="0"/>
				<option key="--resolution" value="4000"/>
				<option key="--discretization" value="0.01"/>
				<option key="--truncation-error" value="0.01"/>
				<option key="--truncation-time-error" value="0.01"/>
				<details>[0.950056,1] (95% CI)</details>
				<plot title="Probability Density Distribution" xaxis="run duration in time" yaxis="probability density">
					<series title="density" type="b(250.807495)" color="0x0000ff" encoding="csv">2682.534939413415,5.537668988245657E-4
2933.342434739872,0.001329040557178958
3184.149930066329,7.198969684719354E-4
3434.957425392786,4.430135190596525E-4
3685.764920719243,2.215067595298263E-4
3936.5724160457,3.322601392947394E-4
4187.379911372158,1.107533797649131E-4
4438.187406698615,5.537668988245657E-5
4688.994902025071,2.215067595298263E-4
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">3409.127676504529,0.0
3409.127676504529,0.001329040557178958
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=250.81, bucket count=9
Runs: 72 in total, 72 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [2683, 4940]
Mean estimate of displayed sample: 3409 ± 127.1 (95% CI)</comment>
				</plot>
				<plot title="Probability Density Confidence Intervals" xaxis="run duration in time" yaxis="probability density">
					<series title="upper limit" type="b(250.807495)" color="0xa0a0ff" encoding="csv">2682.534939413415,0.2406259325030243
2933.342434739872,0.4542961110255666
3184.149930066329,0.2889434084029285
3434.957425392786,0.2072468706667488
3685.764920719243,0.136178649312924
3936.5724160457,0.172608584683674
4187.379911372158,0.09676728911341523
4438.187406698615,0.07497131085391912
4688.994902025071,0.136178649312924
					</series>
					<series title="lower limit" type="b(250.807495)" color="0x0000ff" encoding="csv">2682.534939413415,0.06866420769681664
2933.342434739872,0.226563424488185
3184.149930066329,0.09979350815289616
3434.957425392786,0.04920803927064098
3685.764920719243,0.0153425371111306
3936.5724160457,0.03119750914138448
4187.379911372158,0.003381900326173238
4438.187406698615,3.515744052335976E-4
4688.994902025071,0.0153425371111306
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">3409.127676504529,0.0
3409.127676504529,0.001811333869564958
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=250.81, bucket count=9
Runs: 72 in total, 72 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [2683, 4940]
Mean estimate of displayed sample: 3409 ± 127.1 (95% CI)</comment>
				</plot>
				<plot title="Probability Distribution" xaxis="run duration in time" yaxis="probability">
					<series title="probability" type="b(250.807495)" color="0x0000ff" encoding="csv">2682.534939413415,0.1388888888888889
2933.342434739872,0.3333333333333333
3184.149930066329,0.1805555555555556
3434.957425392786,0.1111111111111111
3685.764920719243,0.05555555555555555
3936.5724160457,0.08333333333333333
4187.379911372158,0.02777777777777778
4438.187406698615,0.01388888888888889
4688.994902025071,0.05555555555555555
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">3409.127676504529,0.0
3409.127676504529,0.3333333333333333
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=250.81, bucket count=9
Runs: 72 in total, 72 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [2683, 4940]
Mean estimate of displayed sample: 3409 ± 127.1 (95% CI)</comment>
				</plot>
				<plot title="Probability Confidence Intervals" xaxis="run duration in time" yaxis="probability">
					<series title="upper limit" type="b(250.807495)" color="0xa0a0ff" encoding="csv">2682.534939413415,0.2406259325030243
2933.342434739872,0.4542961110255666
3184.149930066329,0.2889434084029285
3434.957425392786,0.2072468706667488
3685.764920719243,0.136178649312924
3936.5724160457,0.172608584683674
4187.379911372158,0.09676728911341523
4438.187406698615,0.07497131085391912
4688.994902025071,0.136178649312924
					</series>
					<series title="lower limit" type="b(250.807495)" color="0x0000ff" encoding="csv">2682.534939413415,0.06866420769681664
2933.342434739872,0.226563424488185
3184.149930066329,0.09979350815289616
3434.957425392786,0.04920803927064098
3685.764920719243,0.0153425371111306
3936.5724160457,0.03119750914138448
4187.379911372158,0.003381900326173238
4438.187406698615,3.515744052335976E-4
4688.994902025071,0.0153425371111306
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">3409.127676504529,0.0
3409.127676504529,0.4542961110255666
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=250.81, bucket count=9
Runs: 72 in total, 72 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [2683, 4940]
Mean estimate of displayed sample: 3409 ± 127.1 (95% CI)</comment>
				</plot>
				<plot title="Cumulative Probability Distribution" xaxis="run duration in time" yaxis="probability">
					<series title="cumulative" type="l" color="0x000000" encoding="csv">2682.534939413415,0.0
2933.342434739872,0.1388888888888889
3184.149930066329,0.4722222222222222
3434.957425392786,0.6527777777777778
3685.764920719243,0.7638888888888888
3936.5724160457,0.8194444444444444
4187.379911372158,0.9027777777777778
4438.187406698615,0.9305555555555556
4688.994902025071,0.9444444444444444
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">3409.127676504529,0.0
3409.127676504529,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=250.81, bucket count=9
Runs: 72 in total, 72 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [2683, 4940]
Mean estimate of displayed sample: 3409 ± 127.1 (95% CI)</comment>
				</plot>
				<plot title="Cumulative Probability Confidence Intervals" xaxis="run duration in time" yaxis="probability">
					<series title="upper limit" type="k" color="0x0000dd" encoding="csv">2682.534939413415,0.04994408370585468
2933.342434739872,0.2406259325030243
3184.149930066329,0.5934709234743262
3434.957425392786,0.761187230594636
3685.764920719243,0.8560339363545927
3936.5724160457,0.9002064918471039
4187.379911372158,0.9600104990663975
4438.187406698615,0.9770683408462545
4688.994902025071,0.9846574628888694
					</series>
					<series title="upper limit" type="k" color="0xdd0000" encoding="csv">2682.534939413415,0.0
2933.342434739872,0.06866420769681664
3184.149930066329,0.3533297240566715
3434.957425392786,0.5313671687187012
3685.764920719243,0.6490999659870761
3936.5724160457,0.7110565915970716
4187.379911372158,0.8098896595544408
4438.187406698615,0.8453326851838769
4688.994902025071,0.863821350687076
					</series>
					<series title="cumulative" type="l" color="0x000000" encoding="csv">2682.534939413415,0.0
2933.342434739872,0.1388888888888889
3184.149930066329,0.4722222222222222
3434.957425392786,0.6527777777777778
3685.764920719243,0.7638888888888888
3936.5724160457,0.8194444444444444
4187.379911372158,0.9027777777777778
4438.187406698615,0.9305555555555556
4688.994902025071,0.9444444444444444
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">3409.127676504529,0.0
3409.127676504529,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=250.81, bucket count=9
Runs: 72 in total, 72 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [2683, 4940]
Mean estimate of displayed sample: 3409 ± 127.1 (95% CI)</comment>
				</plot>
				<plot title="Frequency Histogram" xaxis="run duration in time" yaxis="count">
					<series title="count" type="b(250.807495)" color="0x0000ff" encoding="csv">2682.534939413415,10.0
2933.342434739872,24.0
3184.149930066329,13.0
3434.957425392786,8.0
3685.764920719243,4.0
3936.5724160457,6.0
4187.379911372158,2.0
4438.187406698615,1.0
4688.994902025071,4.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">3409.127676504529,0.0
3409.127676504529,24.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=250.81, bucket count=9
Runs: 72 in total, 72 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [2683, 4940]
Mean estimate of displayed sample: 3409 ± 127.1 (95% CI)</comment>
				</plot>
			</result>
		</query>
	</queries>
</nta>
